"use strict";angular.module("ctaApp",["ngRoute","ui.bootstrap","firebase"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",resolve:{routes:function(a){return a.get("https://ctabustracker.firebaseio.com/routes.json")}}}).otherwise({redirectTo:"/"})}]).run(["$rootScope",function(){}]),angular.module("ctaApp").controller("MainCtrl",["$scope","$firebase","$http","$q","$filter","routes",function(a,b,c,d,e,f){function g(){a.map=new google.maps.Map(document.getElementById("map"),{zoom:17,center:a.location,disableDefaultUI:!0});var b=[{stylers:[{hue:"#00ffe6"},{saturation:-20}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"landscape.man_made",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"all",stylers:[{visibility:"off"}]}],c=new google.maps.StyledMapType(b,{name:"Styled Map"});a.map.mapTypes.set("map_style",c),a.map.setMapTypeId("map_style");new google.maps.Marker({position:a.location,icon:{path:"M 125,5 155,90 245,90 175,145 200,230 125,180 50,230 75,145 5,90 95,90 z",fillColor:"yellow",fillOpacity:.8,scale:.1,strokeColor:"gold",strokeWeight:2},title:"Current Position",map:a.map});google.maps.event.addListener(a.map,"bounds_changed",function(){var b=100;angular.forEach(a.stopsInView,function(a){a.setMap(null)});var c=a.map.getBounds();a.stopsInView=[],angular.forEach(a.stops,function(d){return a.stopsInView>b?!1:void(d.lat<c.Aa.j&&d.lat>c.Aa.k&&d.lon>c.qa.j&&d.lon<c.qa.k&&(a.stopsInView[a.stopsInView.length]=new google.maps.Marker({position:new google.maps.LatLng(d.lat,d.lon),title:d.name})))}),a.stopsInView.length<=b&&angular.forEach(a.stopsInView,function(b){b.setMap(a.map),google.maps.event.addListener})})}function h(){var b=d.defer();return"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(c){a.location=new google.maps.LatLng(c.coords.latitude,c.coords.longitude),b.resolve()}):(a.location=new google.maps.LatLng("41.8819","-87.6278"),b.reject()),b.promise}a.routes=f.data,a.stops=[],a.stopsInView=[],a.location={},a.loadMap=function(){if(a.stops.length)console.log(a.stops.length+" cached stops");else{var b=(new Date).getTime();c.get("scripts/stubs/stops.json").success(function(c){angular.forEach(c,function(b){b&&(a.stops[a.stops.length]=b)}),console.log(a.stops.length+" stops retrieved in "+((new Date).getTime()-b)/1e3+" seconds"),h().then(g)})}}}]);